!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JsonicCsv=e()}}((function(){var e={exports:{}};(function(t){(function(){!function(n){"object"==typeof e.exports?e.exports=n():("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:this).Jsonic=n()}((function(){var e=function(e){var t;return function(n){return t||e(t={exports:{},parent:n},t.exports),t.exports}},t=e((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.values=t.keys=t.omap=t.str=t.prop=t.normalt=t.parserwrap=t.trimstk=t.tokenize=t.srcfmt=t.snip=t.regexp=t.mesc=t.makelog=t.isarr=t.filterRules=t.extract=t.escre=t.errinject=t.errdesc=t.entries=t.defprop=t.deep=t.configure=t.clone=t.clean=t.charset=t.badlex=t.assign=t.S=t.JsonicError=void 0;const i=n({}),l=e=>null==e?[]:Object.keys(e);t.keys=l,t.values=e=>null==e?[]:Object.values(e);const s=e=>null==e?[]:Object.entries(e);t.entries=s;const o=(e,...t)=>Object.assign(null==e?{}:e,...t);t.assign=o,t.isarr=e=>Array.isArray(e);const a=Object.defineProperty;t.defprop=a;const u=(e,t)=>Object.entries(e||{}).reduce((e,n)=>{let r=t?t(n):n;void 0===r[0]?delete e[n[0]]:e[r[0]]=r[1];let i=2;for(;void 0!==r[i];)e[r[i]]=r[i+1],i+=2;return e},{});t.omap=u;const c={indent:"  ",space:" ",Object:"Object",Array:"Array",object:"object",string:"string",function:"function",unexpected:"unexpected",map:"map",list:"list",elem:"elem",pair:"pair",val:"val",node:"node",no_re_flags:r.EMPTY,unprintable:"unprintable",invalid_ascii:"invalid_ascii",invalid_unicode:"invalid_unicode",invalid_lex_state:"invalid_lex_state",unterminated_string:"unterminated_string",unterminated_comment:"unterminated_comment",lex:"lex",parse:"parse",error:"error",none:"none",imp_map:"imp,map",imp_list:"imp,list",imp_null:"imp,null",end:"end",open:"open",close:"close",rule:"rule",stack:"stack",nUll:"null",name:"name",make:"make"};t.S=c;class d extends SyntaxError{constructor(e,t,n,r,i){let l=b(e,t=h({},t),n,r,i);super(l.message),o(this,l),v(this)}toJSON(){return{...this,__error:!0,name:this.name,message:this.message,stack:this.stack}}}function p(e,t,n){let i=t.t,l=i[e];return null==l&&r.STRING===typeof e&&(i[l=t.tI++]=e,i[e]=l,i[e.substring(1)]=l,null!=n&&o(n.token,t.t)),l}function m(e,...t){return new RegExp(t.map(e=>e.esc?f(e.toString()):e).join(r.EMPTY),null==e?"":e)}function f(e){return null==e?"":e.replace(/[-\\|\]{}()[^$+*?.!=]/g,"\\$&").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/\n/g,"\\n")}function h(e,...t){let n=c.function===typeof e,r=null!=e&&(c.object===typeof e||n);for(let i of t){let t,l=c.function===typeof i,s=null!=i&&(c.object===typeof i||l);if(r&&s&&!l&&Array.isArray(e)===Array.isArray(i))for(let n in i)e[n]=h(e[n],i[n]);else e=void 0===i?e:l?i:s?c.function===typeof(t=i.constructor)&&c.Object!==t.name&&c.Array!==t.name?i:h(Array.isArray(i)?[]:{},i):i,n=c.function===typeof e,r=null!=e&&(c.object===typeof e||n)}return e}function g(e,t,n,r,i,l){let s={code:t,details:n,token:r,rule:i,ctx:l};return null==e?"":e.replace(/\$([\w_]+)/g,(e,t)=>{let o=JSON.stringify(null!=s[t]?s[t]:null!=n[t]?n[t]:l.meta&&null!=l.meta[t]?l.meta[t]:null!=r[t]?r[t]:null!=i[t]?i[t]:null!=l.opts[t]?l.opts[t]:null!=l.cfg[t]?l.cfg[t]:null!=l[t]?l[t]:"$"+t);return null==o?"":o})}function v(e){e.stack&&(e.stack=e.stack.split("\n").filter(e=>!e.includes("jsonic/jsonic")).map(e=>e.replace(/    at /,"at ")).join("\n"))}function x(e,t,n){let i=0<n.sI?n.sI:0,l=0<n.rI?n.rI:1,s=0<n.cI?n.cI:1,o=null==n.src?r.EMPTY:n.src,a=e.substring(Math.max(0,i-333),i).split("\n"),u=e.substring(i,i+333).split("\n"),c=2+(r.EMPTY+(l+2)).length,d=l<3?1:l-2,p=e=>"\x1b[34m"+(r.EMPTY+d++).padStart(c," ")+" | \x1b[0m"+(null==e?r.EMPTY:e),m=a.length;return[2<m?p(a[m-3]):null,1<m?p(a[m-2]):null,p(a[m-1]+u[0])," ".repeat(c)+"   "+" ".repeat(s-1)+"\x1b[31m"+"^".repeat(o.length||1)+" "+t+"\x1b[0m",p(u[1]),p(u[2])].filter(e=>null!=e).join("\n")}function b(e,t,n,r,i){try{let l=i.cfg,s=i.meta,o=g(l.error[e]||l.error.unknown,e,t,n,r,i);c.function===typeof l.hint&&(l.hint={...l.hint(),...l.hint});let a=["\x1b[31m[jsonic/"+e+"]:\x1b[0m "+o,"  \x1b[34m--\x3e\x1b[0m "+(s&&s.fileName||"<no-file>")+":"+n.rI+":"+n.cI,x(i.src(),o,n),"",g((l.hint[e]||l.hint.unknown||"").trim().split("\n").map(e=>"  "+e).join("\n"),e,t,n,r,i),"","  \x1b[2mhttps://jsonic.senecajs.org\x1b[0m","  \x1b[2m--internal: rule="+r.name+"~"+r.state+"; token="+p(n.tin,i.cfg)+(null==n.why?"":"~"+n.why)+"; plugins="+i.plgn().map(e=>e.name).join(",")+"--\x1b[0m\n"].join("\n"),u={internal:{token:n,ctx:i}};return u={...Object.create(u),message:a,code:e,details:t,meta:s,fileName:s?s.fileName:void 0,lineNumber:n.rI,columnNumber:n.cI}}catch(l){return console.log(l),{}}}function k(e){return"function"==typeof e.debug.print.src?e.debug.print.src:(t,n)=>null==t?r.EMPTY:(n=JSON.stringify(t)).substring(0,e.debug.maxlen)+(e.debug.maxlen<n.length?"...":r.EMPTY)}function y(e,t=44){let n;try{n="object"==typeof e?JSON.stringify(e):""+e}catch(r){n=""+e}return j(t<n.length?n.substring(0,t-3)+"...":n,t)}function j(e,t=5){return void 0===e?"":(""+e).substring(0,t).replace(/[\r\n\t]/g,".")}function S(...e){return null==e?{}:e.filter(e=>!1!==e).map(e=>"object"==typeof e?l(e).join(r.EMPTY):e).join(r.EMPTY).split(r.EMPTY).reduce((e,t)=>(e[t]=t.charCodeAt(0),e),{})}function I(e){for(let t in e)null==e[t]&&delete e[t];return e}t.JsonicError=d,t.configure=function(e,t,n){var r,i,a,c,d,h,g,v,x,b,k,y,j,E,O,M,T,C,P,w,N,_,R,A,L,F,Y,U,$,J,B,D,Z,z,K,V,q,G,H,W,X;const Q=t||{};Q.t=Q.t||{},Q.tI=Q.tI||1;const ee=e=>p(e,Q);!1!==n.standard$&&(ee("#BD"),ee("#ZZ"),ee("#UK"),ee("#AA"),ee("#SP"),ee("#LN"),ee("#CM"),ee("#NR"),ee("#ST"),ee("#TX"),ee("#VL")),Q.fixed={lex:!!(null===(r=n.fixed)||void 0===r?void 0:r.lex),token:n.fixed?u(I(n.fixed.token),([e,t])=>[t,p(e,Q)]):{},ref:void 0},Q.fixed.ref=u(Q.fixed.token,([e,t])=>[e,t]),Q.fixed.ref=Object.assign(Q.fixed.ref,u(Q.fixed.ref,([e,t])=>[t,e])),Q.tokenSet=n.tokenSet?Object.keys(n.tokenSet).reduce((e,t)=>(e[t]=n.tokenSet[t].filter(e=>null!=e).map(e=>ee(e)),e),{...Q.tokenSet}):{},Q.tokenSetDerived={ignore:Object.fromEntries(((null===(i=n.tokenSet)||void 0===i?void 0:i.ignore)||[]).map(e=>[ee(e),!0]))},Q.space={lex:!!(null===(a=n.space)||void 0===a?void 0:a.lex),chars:S(null===(c=n.space)||void 0===c?void 0:c.chars)},Q.line={lex:!!(null===(d=n.line)||void 0===d?void 0:d.lex),chars:S(null===(h=n.line)||void 0===h?void 0:h.chars),rowChars:S(null===(g=n.line)||void 0===g?void 0:g.rowChars),single:!!(null===(v=n.line)||void 0===v?void 0:v.single)},Q.text={lex:!!(null===(x=n.text)||void 0===x?void 0:x.lex),modify:((null===(b=Q.text)||void 0===b?void 0:b.modify)||[]).concat(([null===(k=n.text)||void 0===k?void 0:k.modify]||[]).flat()).filter(e=>null!=e)},Q.number={lex:!!(null===(y=n.number)||void 0===y?void 0:y.lex),hex:!!(null===(j=n.number)||void 0===j?void 0:j.hex),oct:!!(null===(E=n.number)||void 0===E?void 0:E.oct),bin:!!(null===(O=n.number)||void 0===O?void 0:O.bin),sep:null!=(null===(M=n.number)||void 0===M?void 0:M.sep)&&""!==n.number.sep,exclude:null===(T=n.number)||void 0===T?void 0:T.exclude,sepChar:null===(C=n.number)||void 0===C?void 0:C.sep},Q.value={lex:!!(null===(P=n.value)||void 0===P?void 0:P.lex),map:s((null===(w=n.value)||void 0===w?void 0:w.map)||{}).reduce((e,t)=>(null==t[1]||(e[t[0]]=t[1]),e),{})},Q.rule={start:null==(null===(N=n.rule)||void 0===N?void 0:N.start)?"val":n.rule.start,maxmul:null==(null===(_=n.rule)||void 0===_?void 0:_.maxmul)?3:n.rule.maxmul,finish:!!(null===(R=n.rule)||void 0===R?void 0:R.finish),include:(null===(A=n.rule)||void 0===A?void 0:A.include)?n.rule.include.split(/\s*,+\s*/).filter(e=>""!==e):[],exclude:(null===(L=n.rule)||void 0===L?void 0:L.exclude)?n.rule.exclude.split(/\s*,+\s*/).filter(e=>""!==e):[]},Q.map={extend:!!(null===(F=n.map)||void 0===F?void 0:F.extend),merge:null===(Y=n.map)||void 0===Y?void 0:Y.merge},Q.list={property:!!(null===(U=n.list)||void 0===U?void 0:U.property)};let te=Object.keys(Q.fixed.token).sort((e,t)=>t.length-e.length).map(e=>f(e)).join("|"),ne=(null===($=n.comment)||void 0===$?void 0:$.lex)?(n.comment.marker||[]).filter(e=>e.lex).map(e=>f(e.start)).join("|"):"",re=["([",f(l(S(Q.space.lex&&Q.space.chars,Q.line.lex&&Q.line.chars)).join("")),"]",("string"==typeof n.ender?n.ender.split(""):Array.isArray(n.ender)?n.ender:[]).map(e=>"|"+f(e)).join(""),""===te?"":"|",te,""===ne?"":"|",ne,"|$)"];return Q.rePart={fixed:te,ender:re,commentStart:ne},Q.re={ender:m(null,...re),rowChars:m(null,f(null===(J=n.line)||void 0===J?void 0:J.rowChars)),columns:m(null,"["+f(null===(B=n.line)||void 0===B?void 0:B.chars)+"]","(.*)$")},Q.lex={empty:!!(null===(D=n.lex)||void 0===D?void 0:D.empty),emptyResult:null===(Z=n.lex)||void 0===Z?void 0:Z.emptyResult,match:(null===(z=n.lex)||void 0===z?void 0:z.match)?n.lex.match.map(e=>{let t=e(Q,n);return t.maker=e,t}):[]},Q.debug={get_console:(null===(K=n.debug)||void 0===K?void 0:K.get_console)||(()=>console),maxlen:null==(null===(V=n.debug)||void 0===V?void 0:V.maxlen)?99:n.debug.maxlen,print:{config:!!(null===(G=null===(q=n.debug)||void 0===q?void 0:q.print)||void 0===G?void 0:G.config),src:null===(W=null===(H=n.debug)||void 0===H?void 0:H.print)||void 0===W?void 0:W.src}},Q.error=n.error||{},Q.hint=n.hint||{},(null===(X=n.config)||void 0===X?void 0:X.modify)&&l(n.config.modify).forEach(e=>n.config.modify[e](Q,n)),Q.debug.print.config&&Q.debug.get_console().dir(Q,{depth:null}),Q.result={fail:[]},n.result&&(Q.result.fail=[...n.result.fail]),o(e.options,n),o(e.token,Q.t),o(e.fixed,Q.fixed.ref),Q},t.tokenize=p,t.mesc=function(e,t){return(t=new String(e)).esc=!0,t},t.regexp=m,t.escre=f,t.deep=h,t.errinject=g,t.trimstk=v,t.extract=x,t.errdesc=b,t.badlex=function(e,t,n){let r=r=>{let i=e.next(r);if(t===i.tin){let e={};throw null!=i.use&&(e.use=i.use),new d(i.why||c.unexpected,e,i,r,n)}return i};return r.src=e.src,r},t.makelog=function(e,t){var n,r,i;let l=null===(i=null===(r=null===(n=e.opts)||void 0===n?void 0:n.plugin)||void 0===r?void 0:r.debug)||void 0===i?void 0:i.trace;if(t||l)if("number"==typeof(null==t?void 0:t.log)||l){let n=!1,r=null==t?void 0:t.log;(-1===r||l)&&(r=1,n=!0),e.log=(...t)=>{if(n){let n=t.filter(e=>c.object!=typeof e).map(e=>c.function==typeof e?e.name:e).join(c.indent);e.cfg.debug.get_console().log(n)}else e.cfg.debug.get_console().dir(t,{depth:r})}}else"function"==typeof t.log&&(e.log=t.log);return e.log},t.srcfmt=k,t.str=y,t.snip=j,t.clone=function(e){return h(Object.create(Object.getPrototypeOf(e)),e)},t.charset=S,t.clean=I,t.filterRules=function(e,t){let n=["open","close"];for(let r of n)e.def[r]=e.def[r].map(e=>(e.g="string"==typeof e.g?(e.g||"").split(/\s*,+\s*/):e.g||[],e)).filter(e=>t.rule.include.reduce((t,n)=>t||null!=e.g&&-1!==e.g.indexOf(n),0===t.rule.include.length)).filter(e=>t.rule.exclude.reduce((t,n)=>t&&(null==e.g||-1===e.g.indexOf(n)),!0));return e},t.normalt=function(e){if(null!=e.c){let t=e.c.n,n=e.c.d;null==t&&null==n||(e.c=function(e){let r=!0;if(null!=t)for(let n in t)r=r&&(null==e.n[n]||e.n[n]<=(null==t[n]?0:t[n]));return null!=n&&(r=r&&e.d<=n),r},null!=t&&(e.c.n=t),null!=n&&(e.c.d=n))}if(r.STRING===typeof e.g&&(e.g=e.g.split(/\s*,\s*/)),e.s&&0!==e.s.length){const t=e=>e.flat().filter(e=>"number"==typeof e),n=(e,t)=>e.filter(e=>31*t<=e&&e<31*(t+1)),r=(e,t)=>e.reduce((e,n)=>1<<n-(31*t+1)|e,0),i=t([e.s[0]]),l=t([e.s[1]]),s=e;s.S0=0<i.length?new Array(Math.max(...i.map(e=>1+e/31|0))).fill(null).map((e,t)=>t).map(e=>r(n(i,e),e)):null,s.S1=0<l.length?new Array(Math.max(...l.map(e=>1+e/31|0))).fill(null).map((e,t)=>t).map(e=>r(n(l,e),e)):null}else e.s=null;return e},t.prop=function(e,t,n){try{let r,i=t.split(".");for(let t=0;t<i.length;t++)r=i[t],t<i.length-1&&(e=e[r]=e[r]||{});return void 0!==n&&(e[r]=n),e[r]}catch(i){throw new Error("Cannot "+(void 0===n?"get":"set")+" path "+t+" on object: "+y(r)+(void 0===n?"":" to value: "+y(n,22)))}},t.parserwrap=function(e){return{start:function(t,n,l,s){try{return e.start(t,n,l,s)}catch(o){if("SyntaxError"===o.name){let s=0,a=0,u=0,c=r.EMPTY,m=o.message.match(/^Unexpected token (.) .*position\s+(\d+)/i);if(m){c=m[1],s=parseInt(m[2]),a=t.substring(0,s).replace(/[^\n]/g,r.EMPTY).length;let e=s-1;for(;-1<e&&"\n"!==t.charAt(e);)e--;u=Math.max(t.substring(e,s).length,0)}let f=o.token||(0,i.makeToken)("#UK",p("#UK",n.internal().config),void 0,c,(0,i.makePoint)(c.length,s,o.lineNumber||a,o.columnNumber||u));throw new d(o.code||"json",o.details||{msg:o.message},f,{},o.ctx||{uI:-1,opts:n.options,cfg:n.internal().config,token:f,meta:l,src:()=>t,root:()=>{},plgn:()=>n.internal().plugins,rule:{name:"no-rule"},sub:{},xs:-1,v2:f,v1:f,t0:f,t1:f,tC:-1,rs:[],rsI:0,next:()=>f,rsm:{},n:{},log:l?l.log:void 0,F:k(n.internal().config),use:{},NORULE:{name:"no-rule"},NOTOKEN:{name:"no-token"}})}throw o}}}}})),n=e((function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.makeTextMatcher=n.makeNumberMatcher=n.makeCommentMatcher=n.makeStringMatcher=n.makeLineMatcher=n.makeSpaceMatcher=n.makeFixedMatcher=n.makeToken=n.makePoint=n.makeLex=n.makeNoToken=void 0;const i=t({});class l{constructor(e,t,n,r){this.len=-1,this.sI=0,this.rI=1,this.cI=1,this.token=[],this.len=e,null!=t&&(this.sI=t),null!=n&&(this.rI=n),null!=r&&(this.cI=r)}toString(){return"Point["+[this.sI+"/"+this.len,this.rI,this.cI]+(0<this.token.length?" "+this.token:"")+"]"}[r.INSPECT](){return this.toString()}}const s=(...e)=>new l(...e);n.makePoint=s;class o{constructor(e,t,n,i,l,s,o){this.isToken=!0,this.name=r.EMPTY,this.tin=-1,this.val=void 0,this.src=r.EMPTY,this.sI=-1,this.rI=-1,this.cI=-1,this.len=-1,this.name=e,this.tin=t,this.src=i,this.val=n,this.sI=l.sI,this.rI=l.rI,this.cI=l.cI,this.use=s,this.why=o,this.len=null==i?0:i.length}resolveVal(e,t){return"function"==typeof this.val?this.val(e,t):this.val}bad(e,t){return this.err=e,null!=t&&(this.use=(0,i.deep)(this.use||{},t)),this}toString(){return"Token["+this.name+"="+this.tin+" "+(0,i.snip)(this.src)+(void 0===this.val||"#ST"===this.name||"#TX"===this.name?"":"="+(0,i.snip)(this.val))+" "+[this.sI,this.rI,this.cI]+(null==this.use?"":" "+(0,i.snip)(""+JSON.stringify(this.use).replace(/"/g,""),22))+(null==this.err?"":" "+this.err)+(null==this.why?"":" "+(0,i.snip)(""+this.why,22))+"]"}[r.INSPECT](){return this.toString()}}const a=(...e)=>new o(...e);function u(e,t,n){let r=e.pnt,i=t;if(e.cfg.fixed.lex&&null!=n&&0<n.length){let l=void 0,s=e.cfg.fixed.token[n];null!=s&&(l=e.token(s,void 0,n,r)),null!=l&&(r.sI+=l.src.length,r.cI+=l.src.length,null==t?i=l:r.token.push(l))}return i}n.makeToken=a,n.makeNoToken=()=>a("",-1,void 0,r.EMPTY,s(-1)),n.makeFixedMatcher=(e,t)=>{let n=(0,i.regexp)(null,"^(",e.rePart.fixed,")");return function(t){let r=e.fixed;if(!r.lex)return;let i=t.pnt,l=t.src.substring(i.sI).match(n);if(l){let e=l[1],n=e.length;if(0<n){let l=void 0,s=r.token[e];return null!=s&&(l=t.token(s,void 0,e,i),i.sI+=n,i.cI+=n),l}}}},n.makeCommentMatcher=(e,t)=>{let n=t.comment;e.comment={lex:!!n&&!!n.lex,marker:((null==n?void 0:n.marker)||[]).map(t=>{let n={start:t.start,end:t.end,line:!!t.line,lex:!!t.lex,suffixMatch:void 0};return n.getSuffixMatch=t.suffix?()=>{if(t.suffix instanceof Function)return n.suffixMatch=t.suffix;let r=(Array.isArray(t.suffix)?t.suffix:[t.suffix]).map(t=>e.lex.match.find(e=>{var n;return(null===(n=e.maker)||void 0===n?void 0:n.name)==t})).filter(e=>null!=e),l=(...e)=>{r.map(t=>t(...e))};return(0,i.defprop)(l,"name",{value:""+t.suffix}),l}:void 0,n})};let r=e.comment.lex?e.comment.marker.filter(e=>e.lex&&e.line):[],l=e.comment.lex?e.comment.marker.filter(e=>e.lex&&!e.line):[];return function(t,n){if(!e.comment.lex)return;let s=t.pnt,o=t.src.substring(s.sI),a=s.rI,u=s.cI;for(let i of r)if(o.startsWith(i.start)){let r=o.length,l=i.start.length;for(u+=i.start.length;l<r&&!e.line.chars[o[l]];)u++,l++;let a=o.substring(0,l),c=t.token("#CM",void 0,a,s);return s.sI+=a.length,s.cI=u,i.suffixMatch?i.suffixMatch(t,n):i.getSuffixMatch&&(i.suffixMatch=i.getSuffixMatch(),i.suffixMatch&&i.suffixMatch(t,n)),c}for(let r of l)if(o.startsWith(r.start)){let n=o.length,l=r.start.length,c=r.end;for(u+=r.start.length;l<n&&!o.substring(l).startsWith(c);)e.line.rowChars[o[l]]&&(a++,u=0),u++,l++;if(o.substring(l).startsWith(c)){u+=c.length;let e=o.substring(0,l+c.length),n=t.token("#CM",void 0,e,s);return s.sI+=e.length,s.rI=a,s.cI=u,n}return t.bad(i.S.unterminated_comment,s.sI,s.sI+9*r.start.length)}}},n.makeTextMatcher=(e,t)=>{let n=(0,i.regexp)(e.line.lex?null:"s","^(.*?)",...e.rePart.ender);return function(r){let i=e.text,l=r.pnt,s=r.src.substring(l.sI),o=e.value.map,a=s.match(n);if(a){let n=a[1],s=a[2],c=void 0;if(null!=n){let t=n.length;if(0<t){let s=void 0;e.value.lex&&void 0!==(s=o[n])?(c=r.token("#VL",s.val,n,l),l.sI+=t,l.cI+=t):i.lex&&(c=r.token("#TX",n,n,l),l.sI+=t,l.cI+=t)}}if(c&&(c=u(r,c,s)),c&&0<e.text.modify.length){const n=e.text.modify;for(let i=0;i<n.length;i++)c.val=n[i](c.val,r,e,t)}return c}}},n.makeNumberMatcher=(e,t)=>{let n=e.number,r=(0,i.regexp)(null,["^([-+]?(0(",[n.hex?"x[0-9a-fA-F_]+":null,n.oct?"o[0-7_]+":null,n.bin?"b[01_]+":null].filter(e=>null!=e).join("|"),")|[.0-9]+([0-9_]*[0-9])?)","(\\.[0-9]?([0-9_]*[0-9])?)?","([eE][-+]?[0-9]+([0-9_]*[0-9])?)?"].join("").replace(/_/g,n.sep?(0,i.escre)(n.sepChar):""),")",...e.rePart.ender),l=n.sep?(0,i.regexp)("g",(0,i.escre)(n.sepChar)):void 0;return function(t){if(!(n=e.number).lex)return;let i=t.pnt,s=t.src.substring(i.sI),o=e.value.map,a=s.match(r);if(a){let n=a[1],r=a[9],s=void 0,c=!0;if(null!=n&&(c=!e.number.exclude||!n.match(e.number.exclude))){let r=n.length;if(0<r){let a=void 0;if(e.value.lex&&void 0!==(a=o[n]))s=t.token("#VL",a.val,n,i);else{let e=l?n.replace(l,""):n,o=+e;if(isNaN(o)){let t=e[0];"-"!==t&&"+"!==t||(o=("-"===t?-1:1)*+e.substring(1))}isNaN(o)||(s=t.token("#NR",o,n,i),i.sI+=r,i.cI+=r)}}}return c&&(s=u(t,s,r)),s}}},n.makeStringMatcher=(e,t)=>{let n=t.string||{};return e.string=e.string||{},e.string=(0,i.deep)(e.string,{lex:!!(null==n?void 0:n.lex),quoteMap:(0,i.charset)(n.chars),multiChars:(0,i.charset)(n.multiChars),escMap:(0,i.clean)({...n.escape}),escChar:n.escapeChar,escCharCode:null==n.escapeChar?void 0:n.escapeChar.charCodeAt(0),allowUnknown:!!n.allowUnknown,replaceCodeMap:(0,i.omap)((0,i.clean)({...n.replace}),([e,t])=>[e.charCodeAt(0),t]),hasReplace:!1}),e.string.hasReplace=0<(0,i.keys)(e.string.replaceCodeMap).length,function(t){let n=e.string;if(!n.lex)return;let{quoteMap:l,escMap:s,escChar:o,escCharCode:a,multiChars:u,allowUnknown:c,replaceCodeMap:d,hasReplace:p}=n,{pnt:m,src:f}=t,{sI:h,rI:g,cI:v}=m,x=f.length;if(l[f[h]]){const n=f[h],l=h,b=g,k=u[n];++h,++v;let y,j=[];for(;h<x;h++){v++;let r=f[h];if(y=void 0,n===r){h++;break}if(o===r){v++;let e=s[f[++h]];if(null!=e)j.push(e);else if("x"===f[h]){h++;let e=parseInt(f.substring(h,h+2),16);if(isNaN(e))return h-=2,v-=2,m.sI=h,m.cI=v,t.bad(i.S.invalid_ascii,h,h+4);let n=String.fromCharCode(e);j.push(n),h+=1,v+=2}else if("u"===f[h]){let e="{"===f[++h]?(h++,1):0,n=e?6:4,r=parseInt(f.substring(h,h+n),16);if(isNaN(r))return h=h-2-e,v-=2,m.sI=h,m.cI=v,t.bad(i.S.invalid_unicode,h,h+n+2+2*e);let l=String.fromCodePoint(r);j.push(l),h+=n-1+e,v+=n+e}else{if(!c)return m.sI=h,m.cI=v-1,t.bad(i.S.unexpected,h,h+1);j.push(f[h])}}else if(p&&void 0!==(y=d[f.charCodeAt(h)]))j.push(y),v++;else{let r=h,l=n.charCodeAt(0),s=f.charCodeAt(h);for(;(!p||void 0===(y=d[s]))&&h<x&&32<=s&&l!==s&&a!==s;)s=f.charCodeAt(++h),v++;if(v--,void 0===y&&s<32){if(!k||!e.line.chars[f[h]])return m.sI=h,m.cI=v,t.bad(i.S.unprintable,h,h+1);e.line.rowChars[f[h]]&&(m.rI=++g),v=1,j.push(f.substring(r,h+1))}else j.push(f.substring(r,h)),h--}}if(f[h-1]!==n||m.sI===h-1)return m.rI=b,t.bad(i.S.unterminated_string,l,h);const S=t.token("#ST",j.join(r.EMPTY),f.substring(m.sI,h),m);return m.sI=h,m.rI=g,m.cI=v,S}}},n.makeLineMatcher=(e,t)=>function(t){if(!e.line.lex)return;let{chars:n,rowChars:r}=e.line,{pnt:i,src:l}=t,{sI:s,rI:o}=i,a=e.line.single,u=void 0;for(a&&(u={});n[l[s]]&&!(u&&(u[l[s]]=(u[l[s]]||0)+1,a&&1<u[l[s]]));)o+=r[l[s]]?1:0,s++;if(i.sI<s){let e=l.substring(i.sI,s);const n=t.token("#LN",void 0,e,i);return i.sI+=e.length,i.rI=o,i.cI=1,n}},n.makeSpaceMatcher=(e,t)=>function(t){if(!e.space.lex)return;let{chars:n}=e.space,{pnt:r,src:i}=t,{sI:l,cI:s}=r;for(;n[i[l]];)l++,s++;if(r.sI<l){let e=i.substring(r.sI,l);const n=t.token("#SP",void 0,e,r);return r.sI+=e.length,r.cI=s,n}};class c{constructor(e){this.src=r.EMPTY,this.ctx={},this.cfg={},this.pnt=s(-1),this.ctx=e,this.src=e.src(),this.cfg=e.cfg,this.pnt=s(this.src.length)}token(e,t,n,r,l,s){let o,u;return"string"==typeof e?(u=e,o=(0,i.tokenize)(u,this.cfg)):(o=e,u=(0,i.tokenize)(e,this.cfg)),a(u,o,t,n,r||this.pnt,l,s)}next(e){let t,n,r=this.pnt,l=r.sI;if(r.end)t=r.end;else if(0<r.token.length)t=r.token.shift();else if(r.len<=r.sI)r.end=this.token("#ZZ",void 0,"",r),t=r.end;else{for(let r of this.cfg.lex.match)if(t=r(this,e)){n=r;break}t=t||this.token("#BD",void 0,this.src[r.sI],r,void 0,"unexpected")}return this.ctx.log&&this.ctx.log(i.S.indent.repeat(e.d)+i.S.lex,(0,i.tokenize)(t.tin,this.cfg),this.ctx.F(t.src),r.sI,r.rI+":"+r.cI,(null==n?void 0:n.name)||"none",this.ctx.F(this.src.substring(l,l+16))),this.ctx.sub.lex&&this.ctx.sub.lex.map(n=>n(t,e,this.ctx)),t}tokenize(e){return(0,i.tokenize)(e,this.cfg)}bad(e,t,n){return this.token("#BD",void 0,0<=t&&t<=n?this.src.substring(t,n):this.src[this.pnt.sI],void 0,void 0,e)}}n.makeLex=(...e)=>new c(...e)})),r={};Object.defineProperty(r,"__esModule",{value:!0}),r.STRING=r.INSPECT=r.EMPTY=r.AFTER=r.BEFORE=r.CLOSE=r.OPEN=void 0,r.OPEN="o",r.CLOSE="c",r.BEFORE="b",r.AFTER="a",r.EMPTY="",r.INSPECT=Symbol.for("nodejs.util.inspect.custom"),r.STRING="string";var i={};Object.defineProperty(i,"__esModule",{value:!0}),i.defaults=void 0;const l=n({}),s={tag:"-",fixed:{lex:!0,token:{"#OB":"{","#CB":"}","#OS":"[","#CS":"]","#CL":":","#CA":","}},tokenSet:{ignore:["#SP","#LN","#CM"],val:["#TX","#NR","#ST","#VL"],key:["#TX","#NR","#ST","#VL"]},space:{lex:!0,chars:" \t"},line:{lex:!0,chars:"\r\n",rowChars:"\n",single:!1},text:{lex:!0},number:{lex:!0,hex:!0,oct:!0,bin:!0,sep:"_",exclude:void 0},comment:{lex:!0,marker:[{line:!0,start:"#",lex:!0},{line:!0,start:"//",lex:!0},{line:!1,start:"/*",end:"*/",lex:!0}]},string:{lex:!0,chars:"'\"`",multiChars:"`",escapeChar:"\\",escape:{b:"\b",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v",'"':'"',"'":"'","`":"`","\\":"\\","/":"/"},allowUnknown:!0},map:{extend:!0,merge:void 0},list:{property:!0},value:{lex:!0,map:{true:{val:!0},false:{val:!1},null:{val:null}}},ender:[],plugin:{},debug:{get_console:()=>console,maxlen:99,print:{config:!1,src:void 0}},error:{unknown:"unknown error: $code",unexpected:"unexpected character(s): $src",invalid_unicode:"invalid unicode escape: $src",invalid_ascii:"invalid ascii escape: $src",unprintable:"unprintable character: $src",unterminated_string:"unterminated string: $src",unterminated_comment:"unterminated comment: $src",unknown_rule:"unknown rule: $rulename"},hint:function(e=((e,t="replace")=>e[t](/[A-Z]/g,e=>" "+e.toLowerCase())[t](/[~%][a-z]/g,e=>("~"==e[0]?" ":"")+e[1].toUpperCase())),t="~sinceTheErrorIsUnknown,ThisIsProbablyABugInsideJsonic\nitself,OrAPlugin.~pleaseConsiderPostingAGithubIssue -Thanks!\n\n~code: $code,~details: \n$details|~theCharacter(s) $srcWereNotExpectedAtThisPointAsTheyDoNot\nmatchTheExpectedSyntax,EvenUnderTheRelaxedJsonicRules.~ifIt\nisNotObviouslyWrong,TheActualSyntaxErrorMayBeElsewhere.~try\ncommentingOutLargerAreasAroundThisPointUntilYouGetNoErrors,\nthenRemoveTheCommentsInSmallSectionsUntilYouFindThe\noffendingSyntax.~n%o%t%e:~alsoCheckIfAnyPluginsYouAreUsing\nexpectDifferentSyntaxInThisCase.|~theEscapeSequence $srcDoesNotEncodeAValidUnicodeCodePoint\nnumber.~youMayNeedToValidateYourStringDataManuallyUsingTest\ncodeToSeeHow~javaScriptWillInterpretIt.~alsoConsiderThatYour\ndataMayHaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeen\ngeneratedCorrectly.|~theEscapeSequence $srcDoesNotEncodeAValid~a%s%c%i%iCharacter.~you\nmayNeedToValidateYourStringDataManuallyUsingTestCodeToSee\nhow~javaScriptWillInterpretIt.~alsoConsiderThatYourDataMay\nhaveBecomeCorrupted,OrTheEscapeSequenceHasNotBeenGenerated\ncorrectly.|~stringValuesCannotContainUnprintableCharacters (characterCodes\nbelow 32).~theCharacter $srcIsUnprintable.~youMayNeedToRemove\ntheseCharactersFromYourSourceData.~alsoCheckThatItHasNot\nbecomeCorrupted.|~thisStringHasNoEndQuote.|~thisCommentIsNeverClosed.|~noRuleNamed $rulenameIsDefined.~thisIsProbablyAnErrorInThe\ngrammarOfAPlugin.".split("|")){return"unknown|unexpected|invalid_unicode|invalid_ascii|unprintable|unterminated_string|unterminated_comment|unknown_rule".split("|").reduce((n,r,i)=>(n[r]=e(t[i]),n),{})},lex:{match:[l.makeFixedMatcher,l.makeSpaceMatcher,l.makeLineMatcher,l.makeStringMatcher,l.makeCommentMatcher,l.makeNumberMatcher,l.makeTextMatcher],empty:!0,emptyResult:void 0},rule:{start:"val",finish:!0,maxmul:3,include:"",exclude:""},result:{fail:[]},config:{modify:{}},parser:{start:void 0}};i.defaults=s;var o={};Object.defineProperty(o,"__esModule",{value:!0}),o.Parser=o.makeRuleSpec=o.makeRule=void 0;const a=t({}),u=n({});class c{constructor(e,t,n){this.id=-1,this.name=r.EMPTY,this.node=null,this.state=r.OPEN,this.n=Object.create(null),this.d=-1,this.use=Object.create(null),this.keep=Object.create(null),this.bo=!1,this.ao=!1,this.bc=!1,this.ac=!1,this.os=0,this.cs=0,this.id=t.uI++,this.name=e.name,this.spec=e,this.child=t.NORULE,this.parent=t.NORULE,this.prev=t.NORULE,this.o0=t.NOTOKEN,this.o1=t.NOTOKEN,this.c0=t.NOTOKEN,this.c1=t.NOTOKEN,this.node=n,this.d=t.rsI,this.bo=null!=e.def.bo,this.ao=null!=e.def.ao,this.bc=null!=e.def.bc,this.ac=null!=e.def.ac}process(e){return this.spec.process(this,e,this.state)}toString(){return"[Rule "+this.name+"~"+this.id+"]"}}const d=(...e)=>new c(...e);o.makeRule=d;class p{constructor(){this.p=r.EMPTY,this.r=r.EMPTY,this.b=0}}const m=(...e)=>new p(...e),f=m(),h=m();class g{constructor(e,t){this.name=r.EMPTY,this.def={open:[],close:[],bo:[],bc:[],ao:[],ac:[]},this.cfg=e,this.def=Object.assign(this.def,t),this.def.open=(this.def.open||[]).filter(e=>null!=e),this.def.close=(this.def.close||[]).filter(e=>null!=e);for(let n of[...this.def.open,...this.def.close])(0,a.normalt)(n)}tin(e){return(0,a.tokenize)(e,this.cfg)}add(e,t,n){let r=(null==n?void 0:n.append)?"push":"unshift",i=((0,a.isarr)(t)?t:[t]).filter(e=>null!=e&&"object"==typeof e).map(e=>(0,a.normalt)(e)),l="o"===e?"open":"close",s=this.def[l];if(s[r](...i),n){if(n.delete)for(let e=0;e<n.delete.length;e++)s[(s.length+n.delete[e])%s.length]=null;if(n.move)for(let e=0;e<n.move.length;e+=2){let t=(s.length+n.move[e])%s.length,r=(s.length+n.move[e+1])%s.length,i=s[t];s.splice(t,1),s.splice(r,0,i)}this.def[l]=s.filter(e=>null!=e)}return(0,a.filterRules)(this,this.cfg),this}open(e,t){return this.add("o",e,t)}close(e,t){return this.add("c",e,t)}action(e,t,n,r){let i=this.def[t+n];return e?i.push(r):i.unshift(r),this}bo(e,t){return this.action(!t||!!e,r.BEFORE,r.OPEN,t||e)}ao(e,t){return this.action(!t||!!e,r.AFTER,r.OPEN,t||e)}bc(e,t){return this.action(!t||!!e,r.BEFORE,r.CLOSE,t||e)}ac(e,t){return this.action(!t||!!e,r.AFTER,r.CLOSE,t||e)}clear(){return this.def.open.length=0,this.def.close.length=0,this.def.bo.length=0,this.def.ao.length=0,this.def.bc.length=0,this.def.ac.length=0,this}process(e,t,n){let i=r.EMPTY,l=t.F,s="o"===n,o=s?e:t.NORULE,u=this.def,c=s?u.open:u.close,p=s?e.bo?u.bo:null:e.bc?u.bc:null;if(p){let n=void 0;for(let r=0;r<p.length;r++)if((null==(n=p[r].call(this,e,t,o,n))?void 0:n.isToken)&&(null==n?void 0:n.err))return this.bad(n,e,t,{is_open:s})}let m=0<c.length?this.parse_alts(s,c,e,t):h;if(m.h&&(m=m.h(e,t,m,o)||m,i+="H"),m.e)return this.bad(m.e,e,t,{is_open:s});if(m.n)for(let r in m.n)e.n[r]=0===m.n[r]?0:(null==e.n[r]?0:e.n[r])+m.n[r];if(m.u&&(e.use=Object.assign(e.use,m.u)),m.k&&(e.keep=Object.assign(e.keep,m.k)),m.a){i+="A";let n=m.a.call(this,e,t,m);if(n&&n.isToken&&n.err)return this.bad(n,e,t,{is_open:s})}if(m.p){t.rs[t.rsI++]=e;let n=t.rsm[m.p];if(!n)return this.bad(this.unknownRule(t.t0,m.p),e,t,{is_open:s});(o=e.child=d(n,t,e.node)).parent=e,o.n={...e.n},0<Object.keys(e.keep).length&&(o.keep={...e.keep}),i+="@p:"+m.p}else if(m.r){let n=t.rsm[m.r];if(!n)return this.bad(this.unknownRule(t.t0,m.r),e,t,{is_open:s});(o=d(n,t,e.node)).parent=e.parent,o.prev=e,o.n={...e.n},0<Object.keys(e.keep).length&&(o.keep={...e.keep}),i+="@r:"+m.r}else s||(o=t.rs[--t.rsI]||t.NORULE),i+="Z";let f=s?e.ao?u.ao:null:e.ac?u.ac:null;if(f){let n=void 0;for(let r=0;r<f.length;r++)if((null==(n=f[r].call(this,e,t,o,n))?void 0:n.isToken)&&(null==n?void 0:n.err))return this.bad(n,e,t,{is_open:s})}o.why=i,t.log&&t.log(a.S.indent.repeat(e.d)+a.S.node+a.S.space,e.state.toUpperCase(),(e.prev.id+"/"+e.parent.id+"/"+e.child.id).padEnd(12),e.name+"~"+e.id,"w="+i,"n:"+(0,a.entries)(e.n).filter(e=>e[1]).map(e=>e[0]+"="+e[1]).join(";"),"u:"+(0,a.entries)(e.use).map(e=>e[0]+"="+e[1]).join(";"),"k:"+(0,a.entries)(e.keep).map(e=>e[0]+"="+e[1]).join(";"),"<"+l(e.node)+">");let g=0,v=e[s?"os":"cs"]-(m.b||0);for(;g++<v;)t.next();return r.OPEN===e.state&&(e.state=r.CLOSE),o}parse_alts(e,t,n,i){let l=f;l.b=0,l.p=r.EMPTY,l.r=r.EMPTY,l.n=void 0,l.h=void 0,l.a=void 0,l.u=void 0,l.k=void 0,l.e=void 0;let s,o=null,u=0,c=i.cfg.t,d=1<<c.AA-1,p=t.length;for(u=0;u<p;u++){o=t[u];let r=i.t0.tin,a=!1,c=!1;if(s=!0,o.S0&&(a=!0,(s=o.S0[r/31|0]&(1<<r%31-1|d))&&(c=null!=o.S1,o.S1))){c=!0;let e=i.t1.tin;s=o.S1[e/31|0]&(1<<e%31-1|d)}if(e?(n.o0=a?i.t0:i.NOTOKEN,n.o1=c?i.t1:i.NOTOKEN,n.os=(a?1:0)+(c?1:0)):(n.c0=a?i.t0:i.NOTOKEN,n.c1=c?i.t1:i.NOTOKEN,n.cs=(a?1:0)+(c?1:0)),s&&o.c&&(s=s&&o.c(n,i,l)),s)break;o=null}s||c.ZZ===i.t0.tin||(l.e=i.t0),o&&(l.n=null!=o.n?o.n:l.n,l.h=null!=o.h?o.h:l.h,l.a=null!=o.a?o.a:l.a,l.u=null!=o.u?o.u:l.u,l.k=null!=o.k?o.k:l.k,l.g=null!=o.g?o.g:l.g,l.e=o.e&&o.e(n,i,l)||void 0,l.p=null!=o.p?"string"==typeof o.p?o.p:o.p(n,i,l):l.p,l.r=null!=o.r?"string"==typeof o.r?o.r:o.r(n,i,l):l.r,l.b=null!=o.b?"number"==typeof o.b?o.b:o.b(n,i,l):l.b);let m=u<t.length;return i.log&&i.log(a.S.indent.repeat(n.d)+a.S.parse,n.state.toUpperCase(),(n.prev.id+"/"+n.parent.id+"/"+n.child.id).padEnd(12),n.name+"~"+n.id,m?"alt="+u:"no-alt",m&&l.g?"g:"+l.g+" ":"",(m&&l.p?"p:"+l.p+" ":"")+(m&&l.r?"r:"+l.r+" ":"")+(m&&l.b?"b:"+l.b+" ":""),(r.OPEN===n.state?[n.o0,n.o1].slice(0,n.os):[n.c0,n.c1].slice(0,n.cs)).map(e=>e.name+"="+i.F(e.src)).join(" "),"c:"+(o&&o.c?s:r.EMPTY),"n:"+(0,a.entries)(l.n).map(e=>e[0]+"="+e[1]).join(";"),"u:"+(0,a.entries)(l.u).map(e=>e[0]+"="+e[1]).join(";"),"k:"+(0,a.entries)(l.k).map(e=>e[0]+"="+e[1]).join(";"),u<t.length&&o.s?"["+o.s.map(e=>Array.isArray(e)?e.map(e=>c[e]).join("|"):c[e]).join(" ")+"]":"[]",l),l}bad(e,t,n,r){throw new a.JsonicError(e.err||a.S.unexpected,{...e.use,state:r.is_open?a.S.open:a.S.close},e,t,n)}unknownRule(e,t){return e.err="unknown_rule",e.use=e.use||{},e.use.rulename=t,e}}const v=(...e)=>new g(...e);o.makeRuleSpec=v;class x{constructor(e,t){this.rsm={},this.options=e,this.cfg=t}rule(e,t){if(null==e)return this.rsm;let n=this.rsm[e];if(null===t)delete this.rsm[e];else if(void 0!==t){n=this.rsm[e]=this.rsm[e]||v(this.cfg,{}),(n=this.rsm[e]=t(this.rsm[e],this.rsm)||this.rsm[e]).name=e;for(let e of[...n.def.open,...n.def.close])(0,a.normalt)(e);return}return n}start(e,t,n,i){let l,s=(0,u.makeToken)("#ZZ",(0,a.tokenize)("#ZZ",this.cfg),void 0,r.EMPTY,(0,u.makePoint)(-1)),o=(0,u.makeNoToken)(),c={uI:0,opts:this.options,cfg:this.cfg,meta:n||{},src:()=>e,root:()=>l.node,plgn:()=>t.internal().plugins,rule:{},sub:t.internal().sub,xs:-1,v2:s,v1:s,t0:s,t1:s,tC:-2,next:k,rs:[],rsI:0,rsm:this.rsm,log:void 0,F:(0,a.srcfmt)(this.cfg),use:{},NOTOKEN:o,NORULE:{}},p=(e=>d(v(e.cfg,{}),e))(c=(0,a.deep)(c,i));if(c.NORULE=p,c.rule=p,(0,a.makelog)(c,n),""===e){if(this.cfg.lex.empty)return this.cfg.lex.emptyResult;throw new a.JsonicError(a.S.unexpected,{src:e},c.t0,p,c)}let m=e=>(0,a.tokenize)(e,this.cfg),f=(0,a.badlex)((0,u.makeLex)(c),(0,a.tokenize)("#BD",this.cfg),c),h=this.rsm[this.cfg.rule.start];if(null==h)return;let g=d(h,c);l=g;let x=2*(0,a.keys)(this.rsm).length*f.src.length*2*c.cfg.rule.maxmul,b=c.cfg.tokenSetDerived.ignore;function k(){let e,t;c.v2=c.v1,c.v1=c.t0,c.t0=c.t1;do{t=f(g),c.tC++}while(b[t.tin]&&(e=t));return t.ignored=e,c.t1=t,c.t0}k(),k();let y=0;for(;p!==g&&y<x;)c.sub.rule&&c.sub.rule.map(e=>e(g,c)),c.log&&c.log("\n"+a.S.indent.repeat(g.d)+a.S.stack,c.rs.slice(0,c.rsI).map(e=>e.name+"~"+e.id).join("/"),"<<"+c.F(l.node)+">>",c.rs.slice(0,c.rsI).map(e=>"<"+c.F(e.node)+">").join(" "),g,c),c.log&&c.log(a.S.indent.repeat(g.d)+a.S.rule+a.S.space,g.state.toUpperCase(),(g.prev.id+"/"+g.parent.id+"/"+g.child.id).padEnd(12),g.name+"~"+g.id,"["+c.F(c.t0.src)+" "+c.F(c.t1.src)+"]","n:"+(0,a.entries)(g.n).filter(e=>e[1]).map(e=>e[0]+"="+e[1]).join(";"),"u:"+(0,a.entries)(g.use).map(e=>e[0]+"="+e[1]).join(";"),"k:"+(0,a.entries)(g.keep).map(e=>e[0]+"="+e[1]).join(";"),"["+m(c.t0.tin)+" "+m(c.t1.tin)+"]",g,c),c.rule=g,g=g.process(c),y++;if((0,a.tokenize)("#ZZ",this.cfg)!==c.t0.tin)throw new a.JsonicError(a.S.unexpected,{},c.t0,p,c);const j=c.root();if(this.cfg.result.fail.includes(j))throw new a.JsonicError(a.S.unexpected,{},c.t0,p,c);return j}clone(e,t){let n=new x(e,t);return n.rsm=Object.keys(this.rsm).reduce((e,t)=>(e[t]=(0,a.filterRules)(this.rsm[t],this.cfg),e),{}),n}}o.Parser=x;var b={};function k(e){const t=e.token.OB,n=e.token.CB,r=e.token.OS,i=e.token.CS,l=e.token.CL,s=e.token.CA,o=e.token.TX,a=e.token.ST,u=e.token.ZZ,c=e.config(),d=c.tokenSet.val,p=c.tokenSet.key,m=e.util.deep,f=(e,t)=>{if(!t.cfg.rule.finish)return t.t0.src="END_OF_SOURCE",t.t0},h=e=>{const t=e.o0,n=a===t.tin||o===t.tin?t.val:t.src;e.use.key=n};e.rule("val",e=>{e.bo(e=>e.node=void 0).open([{s:[t],p:"map",b:1,g:"map,json"},{s:[r],p:"list",b:1,g:"list,json"},{s:[d],g:"val,json"}]).close([{s:[u],g:"end,json"},{b:1,g:"more,json"}]).bc((e,t)=>{e.node=void 0===e.node?void 0===e.child.node?0===e.os?void 0:e.o0.resolveVal(e,t):e.child.node:e.node})}),e.rule("map",e=>{e.bo(e=>{e.node={}}).open([{s:[t,n],g:"map,json"},{s:[t],p:"pair",n:{pk:0},g:"map,json,pair"}])}),e.rule("list",e=>{e.bo(e=>{e.node=[]}).open([{s:[r,i],g:"list,json"},{s:[r],p:"elem",g:"list,elem,json"}])}),e.rule("pair",e=>{e.open([{s:[p,l],p:"val",u:{pair:!0},a:h,g:"map,pair,key,json"}]).bc((e,t)=>{e.use.pair&&(e.use.prev=e.node[e.use.key],e.node[e.use.key]=e.child.node)}).close([{s:[n],g:"map,pair,json"},{s:[s],r:"pair",g:"map,pair,json"},{s:[u],e:f,g:"map,pair,json"}])}),e.rule("elem",e=>{e.open([{p:"val",u:{elem:!0},g:"list,elem,val,json"}]).bc(e=>{e.use.elem&&e.node.push(e.child.node)}).close([{s:[s],r:"elem",g:"list,elem,json"},{s:[i],g:"list,elem,json"},{s:[u],e:f,g:"list,elem,json"}])});const g=(e,t)=>{let n=e.use.key,r=e.child.node;const i=e.use.prev;r=void 0===r?null:r,e.node[n]=null==i?r:t.cfg.map.merge?t.cfg.map.merge(i,r):t.cfg.map.extend?m(i,r):r};e.rule("val",e=>{e.open([{s:[p,l],p:"map",b:2,n:{pk:1},g:"pair,jsonic"},{s:[d],g:"val,json"},{s:[[n,i]],b:1,g:"val,imp,null,jsonic"},{s:[s],c:{n:{il:0}},p:"list",b:1,g:"list,imp,jsonic"},{s:[s],b:1,g:"list,val,imp,null,jsonic"}],{append:!0,delete:[2]}).close([{s:[[n,i]],b:1,g:"val,json,close"},{s:[s],c:{n:{il:0,pk:0}},n:{il:1},r:"elem",a:e=>e.node=[e.node],g:"list,val,imp,comma,jsonic"},{c:{n:{il:0,pk:0}},n:{il:1},r:"elem",a:e=>e.node=[e.node],g:"list,val,imp,space,jsonic",b:1}],{append:!0,move:[1,-1]})}),e.rule("map",e=>{e.bo(e=>{e.n.il=1+(e.n.il?e.n.il:0),e.n.im=1+(e.n.im?e.n.im:0)}).open([{s:[p,l],p:"pair",b:2,g:"pair,list,val,imp"}],{append:!0})}),e.rule("list",e=>{e.bo(e=>{e.n.il=1+(e.n.il?e.n.il:0),e.n.pk=1+(e.n.pk?e.n.pk:0),e.n.im=1+(e.n.im?e.n.im:0)}).open([{s:[s],p:"elem",b:1,g:"list,elem,val,imp"},{p:"elem",g:"list,elem"}],{append:!0})}),e.rule("pair",e=>{e.open([{s:[s],g:"map,pair,comma"}],{append:!0}).bc((e,t)=>{e.use.pair&&g(e,t)}).close([{s:[n],c:{n:{pk:0}},g:"map,pair,json"},{s:[s,n],c:{n:{pk:0}},g:"map,pair,comma,jsonic"},{s:[s],c:{n:{pk:0}},r:"pair",g:"map,pair,json"},{s:[s],c:{n:{im:1}},r:"pair",g:"map,pair,jsonic"},{s:[d],c:{n:{pk:0}},r:"pair",b:1,g:"map,pair,imp,jsonic"},{s:[d],c:{n:{im:1}},r:"pair",b:1,g:"map,pair,imp,jsonic"},{s:[[n,s,...d]],b:1,g:"map,pair,imp,path,jsonic"},{s:[i],b:1,g:"list,pair,imp,jsonic"},{s:[u],e:f,g:"map,pair,json"}],{append:!0,delete:[0,1,2]})}),e.rule("elem",e=>{e.open([{s:[s,s],b:2,a:e=>e.node.push(null),g:"list,elem,imp,null,jsonic"},{s:[s],a:e=>e.node.push(null),g:"list,elem,imp,null,jsonic"},c.list.property&&{s:[p,l],p:"val",n:{pk:1},u:{elem:!1},a:h,g:"elem,pair,jsonic"}]).bc((e,t)=>{!1===e.use.elem&&(e.use.prev=e.node[e.use.key],g(e,t))}).close([{s:[s,i],g:"list,elem,comma.jsonic"},{s:[s],r:"elem",g:"list,elem,json"},{s:[[...d,t,r]],r:"elem",b:1,g:"list,elem,imp,jsonic"},{s:[i],g:"list,elem,json"},{s:[u],e:f,g:"list,elem,json"}],{delete:[-1,-2,-3]})})}Object.defineProperty(b,"__esModule",{value:!0}),b.makeJSON=b.grammar=void 0,b.grammar=k,b.makeJSON=function(e){let t=e.make({grammar$:!1,text:{lex:!1},number:{hex:!1,oct:!1,bin:!1,sep:null,exclude:/^00+/},string:{chars:'"',multiChars:"",allowUnknown:!1,escape:{v:null}},comment:{lex:!1},map:{extend:!1},lex:{empty:!1},rule:{finish:!1,include:"json"},result:{fail:[void 0,NaN]},tokenSet:{key:["#ST",null,null,null]}});return k(t),t};var y={};Object.defineProperty(y,"__esModule",{value:!0}),y.Debug=void 0;const j=(e,t)=>{const{keys:n,values:r,entries:i}=e.util;e.debug={describe:function(){var t;let l=null===(t=e.options.lex)||void 0===t?void 0:t.match,s=e.rule();return["========= RULES =========",I(e,n(s),s),"\n","========= ALTS =========",r(s).map(t=>"  "+t.name+":\n"+S(e,t,"open")+S(e,t,"close")).join("\n\n"),"\n","========= LEXER =========","  "+(l&&l.map(e=>e.name)||[]).join("\n  "),"\n","\n","========= PLUGIN =========","  "+e.internal().plugins.map(e=>e.name+(e.options?i(e.options).reduce((e,t)=>e+"\n    "+t[0]+": "+JSON.stringify(t[1]),""):"")).join("\n  "),"\n"].join("\n")}};const l=e.use.bind(e);e.use=(...e)=>{let n=l(...e);return t.print&&n.internal().config.debug.get_console().log(n.debug.describe()),n},t.trace};function S(e,t,n){const{entries:r}=e.util;return 0===t.def[n].length?"":"    "+n.toUpperCase()+":\n"+t.def[n].map((t,n)=>{var i,l;return"      "+(""+n).padStart(5," ")+" "+("["+(t.s||[]).map(t=>"number"==typeof t?e.token[t]:"["+t.map(t=>e.token[t])+"]").join(" ")+"] ").padEnd(32," ")+(t.r?" r="+("string"==typeof t.r?t.r:"<F>"):"")+(t.p?" p="+("string"==typeof t.p?t.p:"<F>"):"")+(t.r||t.p?"":"\t")+"\t"+(null==t.b?"":"b="+t.b)+"\t"+(null==t.n?"":"n="+r(t.n).map(([e,t])=>e+":"+t))+"\t"+(null==t.a?"":"A")+(null==t.c?"":"C")+(null==t.h?"":"H")+"\t"+(null==(null===(i=t.c)||void 0===i?void 0:i.n)?"\t":" CN="+r(t.c.n).map(([e,t])=>e+":"+t))+(null==(null===(l=t.c)||void 0===l?void 0:l.d)?"":" CD="+t.c.d)+(t.g?"\tg="+t.g:"")}).join("\n")+"\n"}function I(e,t,n){const{values:r,omap:i}=e.util;return t.reduce((e,t)=>e+"  "+t+":\n    "+r(i({op:E(n,t,"open","p"),or:E(n,t,"open","r"),cp:E(n,t,"close","p"),cr:E(n,t,"close","r")},([e,t])=>[1<t.length?e:void 0,e+": "+t])).join("\n    ")+"\n","")}function E(e,t,n,r){return[...new Set(e[t].def[n].filter(e=>e[r]).map(e=>e[r]).map(e=>"string"==typeof e?e:"<F>"))].join(" ")}y.Debug=j,j.defaults={print:!0,trace:!1};var O={exports:{}};Object.defineProperty(O.exports,"__esModule",{value:!0}),O.exports.EMPTY=O.exports.AFTER=O.exports.BEFORE=O.exports.CLOSE=O.exports.OPEN=O.exports.makeTextMatcher=O.exports.makeNumberMatcher=O.exports.makeCommentMatcher=O.exports.makeStringMatcher=O.exports.makeLineMatcher=O.exports.makeSpaceMatcher=O.exports.makeFixedMatcher=O.exports.makeLex=O.exports.makeRuleSpec=O.exports.makeRule=O.exports.makePoint=O.exports.makeToken=O.exports.make=O.exports.util=O.exports.Debug=O.exports.Parser=O.exports.JsonicError=O.exports.Jsonic=void 0,Object.defineProperty(O.exports,"OPEN",{enumerable:!0,get:function(){return r.OPEN}}),Object.defineProperty(O.exports,"CLOSE",{enumerable:!0,get:function(){return r.CLOSE}}),Object.defineProperty(O.exports,"BEFORE",{enumerable:!0,get:function(){return r.BEFORE}}),Object.defineProperty(O.exports,"AFTER",{enumerable:!0,get:function(){return r.AFTER}}),Object.defineProperty(O.exports,"EMPTY",{enumerable:!0,get:function(){return r.EMPTY}});const M=t({});Object.defineProperty(O.exports,"JsonicError",{enumerable:!0,get:function(){return M.JsonicError}});const T=n({});Object.defineProperty(O.exports,"makePoint",{enumerable:!0,get:function(){return T.makePoint}}),Object.defineProperty(O.exports,"makeToken",{enumerable:!0,get:function(){return T.makeToken}}),Object.defineProperty(O.exports,"makeLex",{enumerable:!0,get:function(){return T.makeLex}}),Object.defineProperty(O.exports,"makeFixedMatcher",{enumerable:!0,get:function(){return T.makeFixedMatcher}}),Object.defineProperty(O.exports,"makeSpaceMatcher",{enumerable:!0,get:function(){return T.makeSpaceMatcher}}),Object.defineProperty(O.exports,"makeLineMatcher",{enumerable:!0,get:function(){return T.makeLineMatcher}}),Object.defineProperty(O.exports,"makeStringMatcher",{enumerable:!0,get:function(){return T.makeStringMatcher}}),Object.defineProperty(O.exports,"makeCommentMatcher",{enumerable:!0,get:function(){return T.makeCommentMatcher}}),Object.defineProperty(O.exports,"makeNumberMatcher",{enumerable:!0,get:function(){return T.makeNumberMatcher}}),Object.defineProperty(O.exports,"makeTextMatcher",{enumerable:!0,get:function(){return T.makeTextMatcher}}),Object.defineProperty(O.exports,"makeRule",{enumerable:!0,get:function(){return o.makeRule}}),Object.defineProperty(O.exports,"makeRuleSpec",{enumerable:!0,get:function(){return o.makeRuleSpec}}),Object.defineProperty(O.exports,"Parser",{enumerable:!0,get:function(){return o.Parser}}),Object.defineProperty(O.exports,"Debug",{enumerable:!0,get:function(){return y.Debug}});const C={tokenize:M.tokenize,srcfmt:M.srcfmt,clone:M.clone,charset:M.charset,trimstk:M.trimstk,makelog:M.makelog,badlex:M.badlex,extract:M.extract,errinject:M.errinject,errdesc:M.errdesc,configure:M.configure,parserwrap:M.parserwrap,mesc:M.mesc,escre:M.escre,regexp:M.regexp,prop:M.prop,str:M.str,clean:M.clean,deep:M.deep,omap:M.omap,keys:M.keys,values:M.values,entries:M.entries};function P(e,t){if("json"===e)return(0,b.makeJSON)(w);let n={parser:{},config:{},plugins:[],sub:{lex:void 0,rule:void 0},mark:Math.random()},r=(0,M.deep)({},t?{...t.options}:!1===(null==e?void 0:e.defaults$)?{}:i.defaults,e||{}),l=function(e,t,n){var r;if(M.S.string===typeof e){let i=l.internal();return((null===(r=s.parser)||void 0===r?void 0:r.start)?(0,M.parserwrap)(s.parser):i.parser).start(e,l,t,n)}return e},s=e=>{if(null!=e&&M.S.object===typeof e){(0,M.deep)(r,e),(0,M.configure)(l,n.config,r);let t=l.internal().parser;n.parser=t.clone(r,n.config)}return{...l.options}},a={token:e=>(0,M.tokenize)(e,n.config,l),fixed:e=>n.config.fixed.ref[e],options:(0,M.deep)(s,r),config:()=>(0,M.deep)(n.config),parse:l,use:function(e,t){const n=e.name.toLowerCase(),r=(0,M.deep)({},e.defaults||{},t||{});l.options({plugin:{[n]:r}});let i=l.options.plugin[n];return l.internal().plugins.push(e),e.options=i,e(l,i)||l},rule:(e,t)=>l.internal().parser.rule(e,t)||l,lex:e=>{let t=r.lex.match;t.unshift(e),l.options({lex:{match:t}})},make:e=>P(e,l),empty:e=>P({defaults$:!1,standard$:!1,grammar$:!1,...e||{}}),id:"Jsonic/"+Date.now()+"/"+(""+Math.random()).substring(2,8).padEnd(6,"0")+(null==s.tag?"":"/"+s.tag),toString:()=>a.id,sub:e=>(e.lex&&(n.sub.lex=n.sub.lex||[],n.sub.lex.push(e.lex)),e.rule&&(n.sub.rule=n.sub.rule||[],n.sub.rule.push(e.rule)),l),util:C};if((0,M.defprop)(a.make,M.S.name,{value:M.S.make}),(0,M.assign)(l,a),(0,M.defprop)(l,"internal",{value:()=>n}),t){for(let n in t)void 0===l[n]&&(l[n]=t[n]);l.parent=t;let e=t.internal();n.config=(0,M.deep)({},e.config),(0,M.configure)(l,n.config,r),(0,M.assign)(l.token,n.config.t),n.plugins=[...e.plugins],n.parser=e.parser.clone(r,n.config)}else n.config=(0,M.configure)(l,void 0,r),n.plugins=[],n.parser=new o.Parser(r,n.config),!1!==r.grammar$&&(0,b.grammar)(l);return l}O.exports.util=C,O.exports.make=P;let w=void 0,N=w=P();return O.exports.Jsonic=N,delete w.options,delete w.use,delete w.rule,delete w.lex,delete w.token,delete w.fixed,w.Jsonic=w,w.JsonicError=M.JsonicError,w.Parser=o.Parser,w.Debug=y.Debug,w.makeLex=T.makeLex,w.makeToken=T.makeToken,w.makePoint=T.makePoint,w.makeRule=o.makeRule,w.makeRuleSpec=o.makeRuleSpec,w.makeFixedMatcher=T.makeFixedMatcher,w.makeSpaceMatcher=T.makeSpaceMatcher,w.makeLineMatcher=T.makeLineMatcher,w.makeStringMatcher=T.makeStringMatcher,w.makeCommentMatcher=T.makeCommentMatcher,w.makeNumberMatcher=T.makeNumberMatcher,w.makeTextMatcher=T.makeTextMatcher,w.OPEN=r.OPEN,w.CLOSE=r.CLOSE,w.BEFORE=r.BEFORE,w.AFTER=r.AFTER,w.EMPTY=r.EMPTY,w.util=C,w.make=P,O.exports.default=N,O.exports=O.exports.Jsonic,O.exports}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),e=e.exports;var t={};Object.defineProperty(t,"__esModule",{value:!0}),t.buildCsvStringMatcher=t.Csv=void 0;const n=(e,t)=>{var n;const i=!!t.strict,l=!!t.object,s=!!t.header;let o=!!t.trim,a=!!t.comment,u=!!t.number,c=!!t.value,d=!!(null===(n=t.record)||void 0===n?void 0:n.empty);const p=t.stream;if(i?(!1!==t.string.csv&&e.lex(r(t)),e.options({rule:{exclude:"jsonic,imp"}})):(!0===t.string.csv&&e.lex(r(t)),o=null===t.trim||o,a=null===t.comment||a,u=null===t.number||u,c=null===t.value||c,e.options({rule:{exclude:"imp"}})),p){let t=e.internal().parser,n=t.start.bind(t);t.start=(...e)=>{try{return n(...e)}catch(t){p("error",t)}}}let m={};i&&(m={"#OB":null,"#CB":null,"#OS":null,"#CS":null,"#CL":null}),t.field.separation&&(m["#CA"]=t.field.separation);let f=e.internal().config.tokenSet.val,h={rule:{start:"csv"},fixed:{token:m},tokenSet:{ignore:[i?null:void 0,null,void 0]},number:{lex:u},value:{lex:c},comment:{lex:a},lex:{emptyResult:[]},line:{single:d,chars:null==t.record.separators?void 0:t.record.separators,rowChars:null==t.record.separators?void 0:t.record.separators},error:{csv_extra_field:"unexpected extra field value: $fsrc",csv_missing_field:"missing field"},hint:{csv_extra_field:"Row $row has too many fields (the first of which is: $fsrc). Only $len\nfields per row are expected.",csv_missing_field:"Row $row has too few fields. $len fields per row are expected."}};e.options(h);let{LN:g,CA:v,SP:x,ZZ:b}=e.token;e.rule("csv",e=>(e.bo((e,t)=>{t.use.recordI=0,p&&p("start"),e.node=[]}).open([{s:[b]},!d&&{s:[g],r:"newline"},{p:"record"}]).ac(()=>{p&&p("end")}),e)),e.rule("newline",e=>{e.open([{s:[g,g],r:"newline"},{s:[g],r:"newline"},{s:[b]},{r:"record"}]).close([{s:[g,g],r:"newline"},{s:[g],r:"newline"},{s:[b]},{r:"record"}])}),e.rule("record",e=>(e.open([{p:"list"}]).close([{s:[b]},{s:[g,b]},{s:[g],r:d?"record":"newline"}]).bc((e,n)=>{let r=n.use.fields||t.field.names;if(0===n.use.recordI&&s)n.use.fields=void 0===e.child.node?[]:e.child.node;else{let i=e.child.node||[];if(l){let e={},l=0;if(r){if(t.field.exact&&i.length!==r.length)return n.t0.bad(i.length>r.length?"csv_extra_field":"csv_missing_field");let s=0;for(;s<r.length;s++)e[r[s]]=void 0===i[s]?t.field.empty:i[s];l=s}for(;l<i.length;l++)e[t.field.nonameprefix+l]=void 0===i[l]?t.field.empty:i[l];i=e}else for(let e=0;e<i.length;e++)i[e]=void 0===i[e]?t.field.empty:i[e];p?p("record",i):e.node.push(i)}n.use.recordI++}),e)),e.rule("list",e=>e.open([{s:[g],b:1}])),e.rule("elem",e=>e.open([{s:[v],b:1,a:e=>e.node.push(t.field.empty)}],{append:!1}).close([{s:[v,g],b:1,a:e=>e.node.push(t.field.empty)},{s:[g],b:1}],{append:!1})),e.rule("val",e=>e.open([{s:[f,x],b:2,p:"text"},{s:[x],b:1,p:"text"},{s:[g],b:1}],{append:!1})),e.rule("text",e=>e.open([{s:[f,x],b:1,r:"text",n:{text:1},g:"csv,space,follows",a:e=>{let t=1===e.n.text?e:e.prev;e.node=t.node=(1===e.n.text?"":e.prev.node)+e.o0.val}},{s:[x,f],r:"text",n:{text:1},g:"csv,space,leads",a:e=>{let t=1===e.n.text?e:e.prev;e.node=t.node=(1===e.n.text?"":e.prev.node)+(2<=e.n.text||!o?e.o0.src:"")+e.o1.src}},{s:[x,[v,g,b]],b:1,n:{text:1},g:"csv,end",a:e=>{let t=1===e.n.text?e:e.prev;e.node=t.node=(1===e.n.text?"":e.prev.node)+(o?"":e.o0.src)}},{s:[x],n:{text:1},g:"csv,space",a:e=>{if(i){let t=1===e.n.text?e:e.prev;e.node=t.node=(1===e.n.text?"":e.prev.node)+(o?"":e.o0.src)}},p:i?void 0:"val"},{}]).bc(e=>{e.parent.node=void 0===e.child.node?e.node:e.child.node}))};function r(t){return function(n,r){return function(r){let i={[t.string.quote]:!0},{pnt:l,src:s}=r,{sI:o,rI:a,cI:u}=l,c=s.length;if(i[s[o]]){const t=s[o],i=o,d=a;++o,++u;let p=[];for(;o<c;o++)if(u++,t===s[o]){if(u++,t!==s[++o])break;p.push(t)}else{let e=o,i=t.charCodeAt(0),d=s.charCodeAt(o);for(;o<c&&32<=d&&i!==d;)d=s.charCodeAt(++o),u++;if(u--,n.line.chars[s[o]])n.line.rowChars[s[o]]&&(l.rI=++a),u=1,p.push(s.substring(e,o+1));else{if(d<32)return l.sI=o,l.cI=u,r.bad("unprintable",o,o+1);p.push(s.substring(e,o)),o--}}if(s[o-1]!==t||l.sI===o-1)return l.rI=d,r.bad("unterminated_string",i,o);const m=r.token("#ST",p.join(e.EMPTY),s.substring(l.sI,o),l);return l.sI=o,l.rI=a,l.cI=u,m}}}}return t.Csv=n,t.buildCsvStringMatcher=r,n.defaults={trim:null,comment:null,number:null,value:null,header:!0,object:!0,stream:null,strict:!0,field:{separation:null,nonameprefix:"field~",empty:"",names:void 0,exact:!1},record:{separators:null,empty:!1},string:{quote:'"',csv:null}},t}));